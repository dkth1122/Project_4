<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.example.project.mapper.CartMapper">
	
	<!-- 장바구니 -->
	<select id="cart" parameterType="hashmap" resultType="com.example.project.model.Wish">
	SELECT *
	FROM T4_WISH W
	LEFT JOIN T4_PRODUCT P ON W.P_NO = P.P_NO
	</select>
	
	<delete id="deletecart" parameterType="hashmap">
		DELETE FROM T4_WISH
		WHERE p_No = #{pNo}
		
	</delete>
	
	<!-- 구매확정으로 업데이트 -->
	<update id="mypageOrderConfirm" parameterType="hashmap">
		UPDATE T4_DELIVERY
		SET
		   D_STATE = '구매확정'
		WHERE BUY_NO = #{buyNo}
	</update>
	
	<!-- 구매 전 취소 --> 
	<update id="mypageOrderCancel" parameterType="hashmap">
		UPDATE T4_DELIVERY D
		INNER JOIN T4_ORDER O ON D.BUY_NO = O.BUY_NO
		SET
		   D_STATE = '고객 사유로 거절',
		   EXCHANGE = 'R'
		WHERE D.BUY_NO = #{buyNo}
	</update>
	
	<!-- 배송 완료 후 교환/반품 -->
	<!-- 1. 기존 오더/딜리버리 상태변경 -->
	<update id="mypageOrderchangeUpdate" parameterType="hashmap">
		UPDATE T4_DELIVERY D
		INNER JOIN T4_ORDER O ON D.BUY_NO = O.BUY_NO
		SET
		   D_STATE = #{dState}
		   EXCHANGE = #{exchange}
		WHERE D.BUY_NO = #{buyNo}
	</update>
	<!-- 2. 교환/반품사유 인서트 -->
	<insert id="mypageOrderchangeInsert" parameterType="hashmap">
		INSERT INTO T4_EXCHANGE VALUES
		(NULL, #{buyNo}, #{exchange}, #{bReasons});
	</insert>
	
	
	
	
	
</mapper>