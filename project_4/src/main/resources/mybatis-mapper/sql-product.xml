<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.example.project.mapper.ProductMapper">
	<!-- 상품등록 -->
	<insert id="insertProduct" parameterType="hashmap" >
		INSERT INTO T4_PRODUCT VALUES
		(#{pNo}, #{pName}, #{price}, #{stock}, #{membership}, NOW(), #{pLimit}, #{category}, #{artist}, 'N', 0, #{fYn})
	</insert>
	
	<!-- 상품출력 -->
	<select id="selectProductList" parameterType="hashmap" resultType="com.example.project.model.Product">
		SELECT * FROM T4_PRODUCT
		WHERE 1=1
		<!-- 상품페이지 카테고리 / 아티스트로 종류 출력 -->
		<if test="category != null and artist != null">
        	AND CATEGORY = #{category} AND ARTIST = #{artist}
    	</if> 
    	LIMIT #{startNum}, #{lastNum}
	</select>
	
	<!-- 상품페이지 출력 -->
	<select id="selectVProductList" parameterType="hashmap" resultType="com.example.project.model.Product">
		SELECT * FROM T4_PRODUCT
	</select>
	
	<!-- 페이징용 갯수 -->
	<select id="selectCnt" resultType="int">
		SELECT COUNT(*) FROM T4_PRODUCT
	</select>
	
	<!-- 상품 조회 이미테이블 조인 수정 여대현-->
	<select id="selectProductInfo" parameterType="hashmap" resultType="com.example.project.model.Product">
		SELECT * 
		FROM T4_PRODUCT P
		LEFT JOIN T4_PRODUCT_IMG I ON P.P_NO = I.P_NO
		WHERE P.P_NO = #{pNo}
	</select>
	
	<!-- 아티스트별 상품 조회 > 어드민 페이지 -->
	<select id="searchProductList" parameterType="hashmap" resultType="com.example.project.model.Product">
	  SELECT * FROM T4_PRODUCT
	  <if test="artist != 'All'">
	    WHERE ARTIST = #{artist}
	  </if>
	  LIMIT #{startNum}, #{lastNum}
	</select>
	
	<!-- 상품 조회 > 어드민 페이지 -->
	<select id="searchProductList2" parameterType="hashmap" resultType="com.example.project.model.Product">
	  SELECT * FROM T4_PRODUCT
	  <if test="keyword != '' and keyword != null">
	    WHERE P_NAME LIKE CONCAT('%', #{keyword}, '%')
	      OR P_NO LIKE CONCAT('%', #{keyword}, '%')
	  </if>
	  LIMIT #{startNum}, #{lastNum}
	</select>

	
	<!-- 상품 삭제 -->
	<delete id="deleteProduct" parameterType="hashmap">
		DELETE FROM T4_PRODUCT
		WHERE P_NO = #{pNo}
	</delete>
	
	<!-- 상품 재고 추가 -->
	<update id="productStockPLUS" parameterType="hashmap">
		UPDATE T4_PRODUCT
		SET
			STOCK = #{stock}
		WHERE P_NO = #{pNo}
	</update>
	
	
	<!-- 이미지등록 -->
	<insert id="insertProductImg" parameterType="hashmap" >
		INSERT INTO T4_PRODUCT_IMG(P_NO, path, class)
		VALUES
		(#{pNo}, #{path}, 'Y')
	</insert>
	
	
	<!--  체크박스로  찜목록 제거  -->
   <delete id="deleteWishProduct" parameterType="hashmap">
      DELETE FROM T4_WISH
      WHERE WNUM IN   
   <foreach collection="list" item="item" open="(" close=")" separator=",">
         #{item}
   </foreach>
   </delete>
   
   <!-- 찜목록 출력 -->
   <select id="selectWishProdeuct" parameterType="hashmap" resultType="com.example.project.model.Wish">
      SELECT *
      FROM T4_WISH W
      LEFT JOIN T4_PRODUCT P ON W.P_NO = P.P_NO
      WHERE U_ID = #{uId}
   </select>
   
   <!-- 찜목록 단일 삭제 -->
   <delete id="deleteSingleProdeuctWish" parameterType="hashmap">
      DELETE FROM T4_WISH
      WHERE WNUM = #{wnum}   
   </delete>
   
   <!-- 찜목록 전체 삭제 -->
   <delete id="deleteAllWish" parameterType="hashmap">
      DELETE FROM T4_WISH
      WHERE U_ID = #{uId}   
   </delete>
   <!-- 카트 장바구니 등록 -->
   <insert id="insertcart" parameterType="hashmap">   
   INSERT INTO T4_CART (U_ID , P_NO) VALUES 
   (#{uId} , #{pNo})
   </insert>
   
   <!-- 결제시 오더 테이블 등록 -->
   <insert id="insertProductBuy" parameterType="hashmap">
    	INSERT INTO T4_ORDER VALUES
		(NULL, CAST(ROUND(UNIX_TIMESTAMP(NOW())) AS UNSIGNED), #{buyer_name}, #{pNo}, #{pg_tid}, NOW(), #{oCount}, '', 0, #{oMessage})
   </insert>
   <!-- 결제시 딜리버리 테이블 등록 -->
   <insert id="insertProductBuy2" parameterType="hashmap">
		INSERT INTO T4_DELIVERY (BUY_NO, O_NO, U_ID, D_STATE)
		VALUES (#{buyNo}, #{oNo}, #{uId}, '업체확인중')
   </insert>
   
   
   <!-- 아티스트별 상품 페이지 구현 -->
		<!-- 상품출력 -->
	<select id="selectProductMain" parameterType="hashmap" resultType="com.example.project.model.Product">
	    SELECT * FROM T4_PRODUCT P
	    LEFT JOIN T4_PRODUCT_IMG I ON P.P_NO = I.P_NO
	    WHERE 1=1
	        AND ARTIST = #{artist}
	    <if test="ctg != null and ctg != ''" >
	        AND CATEGORY = #{ctg}
	    </if>
	    <choose>
	        <when test="selectedOption == 'nameList'">
	            ORDER BY P_NAME ASC
	        </when>
	        <when test="selectedOption == 'minPrice'">
	            ORDER BY PRICE ASC
	        </when>
	        <when test="selectedOption == 'maxPrice'">
	            ORDER BY PRICE DESC
	        </when>
	        <otherwise>
	            <!-- 기본 정렬 조건을 추가할 수 있습니다. -->
	        </otherwise>
	    </choose>
	    <!-- AND CLASS = 'Y' 추후 더미데이터 추가 후 활성화 예정 -->
	    LIMIT #{startNum}, #{lastNum}
	</select>
	
	<!-- 페이징용 갯수 -->
	<select id="selectMainCnt" resultType="int">
		SELECT COUNT(*) FROM T4_PRODUCT
		WHERE ARTIST = #{artist}
	</select>
</mapper>